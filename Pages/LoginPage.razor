@page "/login"
@using System.Net.Http.Json
@using System.Text.Json
@inject HttpClient HttpClient
    <div class="container mt-4 p-4 ">
      <ul class="breadcrumb" aria-label="bread-crumb">
  <li><NavLink href="/" class="nav" Match="NavLinkMatch.All">Hem</NavLink></li>

  <li>Logga in</li>
</ul>
     <p class="citat text-center">En salong för alla</p>
    <div class="flex-grow-1">

        <h1 class="mb-4">Logga in</h1>
        <!--Inloggningsformulär-->
        <form @onsubmit="Login">
            <div class="form-group">
                <label for="email">E-post:</label>
                <input type="email" class="form-control" id="email" @bind="email" required />
            </div>
            <div class="form-group">
                <label for="password">Lösenord:</label>
                <input type="password" class="form-control" id="password" @bind="password" required />
            </div>
            <button type="submit" class="btn btn-standard">Logga in</button>
        </form>
    </div>
</div>
@code {
    //variabler
    private string email;
    private string password;


private async Task Login()
{
    //variabler från modell
    var loginModel = new { Email = email, Password = password };
    //skickar inloggningsuppgifter
    var response = await HttpClient.PostAsJsonAsync("http://localhost:5004/api/Customer/Login", loginModel);

    if (response.IsSuccessStatusCode)
    {
        var customer = await response.Content.ReadFromJsonAsync<Customer>();
        if (customer != null)
        {
            // Spara användarens information 
            await JSRuntime.InvokeVoidAsync("localStorage.setItem", "loggedInCustomer", JsonSerializer.Serialize(customer));

            // Konstruera den korrekta URL:en för användarens sida
            var customerPageUrl = $"/customer/{customer.Id}";
            
            // Navigera till användarens sida
            NavigationManager.NavigateTo(customerPageUrl);
        }
        else
        {
            
        }
    }
    else
    {
       
    }
}
//klass för kunderna 
    public class Customer
    {
        public int Id { get; set; }
        public string Email { get; set; }
        public string Password { get; set; }
    
    }
}
